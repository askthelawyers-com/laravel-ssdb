name: Laravel ssdb test

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # - uses: actions/checkout@v1
      - name: Install ssdb
        run: |
          cd /tmp
          wget --no-check-certificate https://github.com/ideawu/ssdb/archive/master.zip
          unzip master
          cd ssdb-master
          make
          sudo make install
      - name: Start ssdb
        run: |
          touch /usr/local/ssdb/log.txt
          chmod 777 /usr/local/ssdb/log.txt
          sudo /usr/local/ssdb/ssdb-server -d ssdb.conf
      - name: Installing PHP
        uses: shivammathur/setup-php@master
        with:
          php-version: 7.3
          extension-csv: mbstring, xdebug #optional
          ini-values-csv: "post_max_size=256M, short_open_tag=On" #optional
      - name: Check PHP Version
        run: php -v
      - name: Check Composer Version
        run: composer -V
      - name: Check PHP Extensions
        run: php -m
      - name: Init laravel app
        run: composer create-project --prefer-dist laravel/laravel webapp
      - name: Composer install webapp
        run: |
          cd webapp
          composer install huangdijia/laravel-ssdb
